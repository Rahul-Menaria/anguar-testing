"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[3596],{3596:(Bt,$,g)=>{g.r($),g.d($,{EditimagePageModule:()=>Zt});var S=g(8583),V=g(665),h=g(3083),x=g(3318);const k="application/font-woff",A="image/jpeg",Y={woff:k,woff2:k,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:A,jpeg:A,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"},X=function(){let n=0;return()=>(n+=1,`u${`0000${(Math.random()*Math.pow(36,4)<<0).toString(36)}`.slice(-4)}${n}`)}();function v(t){const n=function(t){const n=/\.([^./]*?)$/g.exec(t);return n?n[1]:""}(t).toLowerCase();return Y[n]||""}function I(t){return-1!==t.search(/^(data:)/)}function P(t,n){return`data:${n};base64,${t}`}function R(t){return t.split(/,/)[1]}function m(t){const n=[];for(let e=0,o=t.length;e<o;e+=1)n.push(t[e]);return n}function y(t,n){const e=window.getComputedStyle(t).getPropertyValue(n);return parseFloat(e.replace("px",""))}function C(t){return new Promise((n,e)=>{const o=new Image;o.onload=()=>n(o),o.onerror=e,o.crossOrigin="anonymous",o.src=t})}const _={};function T(t,n){let e=t.replace(/\?.*/,"");if(function(t){return/ttf|otf|eot|woff2?/i.test(t)}(e)&&(e=e.replace(/.*\//,"")),_[e])return _[e];n.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime());const s=(window.fetch?window.fetch(t).then(r=>r.blob().then(l=>({blob:l,contentType:r.headers.get("Content-Type")||""}))).then(({blob:r,contentType:l})=>new Promise((u,f)=>{const a=new FileReader;a.onloadend=()=>u({contentType:l,blob:a.result}),a.onerror=f,a.readAsDataURL(r)})).then(({blob:r,contentType:l})=>({contentType:l,blob:R(r)})):new Promise((r,l)=>{const u=new XMLHttpRequest;u.onreadystatechange=()=>{if(4!==u.readyState)return;if(200!==u.status)return void l(new Error(`Failed to fetch resource: ${t}, status: ${u.status}`));const d=new FileReader;d.onloadend=()=>{r({blob:R(d.result),contentType:u.getResponseHeader("Content-Type")||""})},d.readAsDataURL(u.response)},u.ontimeout=()=>{l(new Error(`Timeout of 30000ms occured while fetching resource: ${t}`))},u.responseType="blob",u.timeout=3e4,u.open("GET",t,!0),u.send()})).catch(r=>{let l="";if(n.imagePlaceholder){const f=n.imagePlaceholder.split(/,/);f&&f[1]&&(l=f[1])}let u=`Failed to fetch resource: ${t}`;return r&&(u="string"==typeof r?r:r.message),u&&console.error(u),l});return _[e]=s,s}var M;(M||(M={})).clonePseudoElement=function(s,r,l){const u=window.getComputedStyle(s,l),f=u.getPropertyValue("content");if(""===f||"none"===f)return;const a=X();try{r.className=`${r.className} ${a}`}catch(Dt){return}const d=document.createElement("style");d.appendChild(function(s,r,l){const u=`.${s}:${r}`,f=l.cssText?function(s){const r=s.getPropertyValue("content");return`${s.cssText} content: '${r.replace(/'|"/g,"")}';`}(l):function(s){return m(s).map(r=>`${r}: ${s.getPropertyValue(r)}${s.getPropertyPriority(r)?" !important":""};`).join(" ")}(l);return document.createTextNode(`${u}{${f}}`)}(a,l,u)),r.appendChild(d)};var E=function(t,n,e,o){return new(e||(e=Promise))(function(s,r){function l(a){try{f(o.next(a))}catch(d){r(d)}}function u(a){try{f(o.throw(a))}catch(d){r(d)}}function f(a){a.done?s(a.value):function(s){return s instanceof e?s:new e(function(r){r(s)})}(a.value).then(l,u)}f((o=o.apply(t,n||[])).next())})};function B(t,n,e){return E(this,void 0,void 0,function*(){return e||!n.filter||n.filter(t)?Promise.resolve(t).then(o=>function(t,n){return E(this,void 0,void 0,function*(){if(t instanceof HTMLCanvasElement){const e=t.toDataURL();return"data:,"===e?Promise.resolve(t.cloneNode(!1)):C(e)}return t instanceof HTMLVideoElement&&t.poster?Promise.resolve(t.poster).then(e=>T(e,n)).then(e=>P(e.blob,v(t.poster)||e.contentType)).then(e=>C(e)):Promise.resolve(t.cloneNode(!1))})}(o,n)).then(o=>function(t,n,e){var o;return E(this,void 0,void 0,function*(){const i=m((null!==(o=t.shadowRoot)&&void 0!==o?o:t).childNodes);return 0===i.length?Promise.resolve(n):i.reduce((s,r)=>s.then(()=>B(r,e)).then(l=>{l&&n.appendChild(l)}),Promise.resolve()).then(()=>n)})}(t,o,n)).then(o=>function(t,n){return E(this,void 0,void 0,function*(){return n instanceof Element?Promise.resolve().then(()=>function(t,n){const e=window.getComputedStyle(t),o=n.style;!o||(e.cssText?o.cssText=e.cssText:m(e).forEach(i=>{o.setProperty(i,e.getPropertyValue(i),e.getPropertyPriority(i))}))}(t,n)).then(()=>function(t,n){[":before",":after"].forEach(o=>M.clonePseudoElement(t,n,o))}(t,n)).then(()=>function(t,n){t instanceof HTMLTextAreaElement&&(n.innerHTML=t.value),t instanceof HTMLInputElement&&n.setAttribute("value",t.value)}(t,n)).then(()=>n):n})}(t,o)):Promise.resolve(null)})}const H=/url\((['"]?)([^'"]+?)\1\)/g,lt=/url\([^)]+\)\s*format\((["'])([^"']+)\1\)/g,ft=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function W(t){return-1!==t.search(H)}function j(t,n,e){if(!W(t))return Promise.resolve(t);const o=function(t,{preferredFontFormat:n}){return n?t.replace(ft,e=>{for(;;){const[o,,i]=lt.exec(e)||[];if(!i)return"";if(i===n)return`src: ${o};`}}):t}(t,e);return Promise.resolve(o).then(ht).then(i=>i.reduce((s,r)=>s.then(l=>function(t,n,e,o,i){const s=e?function(t,n){if(t.match(/^[a-z]+:\/\//i))return t;if(t.match(/^\/\//))return window.location.protocol+t;if(t.match(/^[a-z]+:/i))return t;const e=document.implementation.createHTMLDocument(),o=e.createElement("base"),i=e.createElement("a");return e.head.appendChild(o),e.body.appendChild(i),n&&(o.href=n),i.href=t,i.href}(n,e):n;return Promise.resolve(s).then(r=>T(r,o)).then(r=>"string"==typeof r?P(r,v(n)):P(r.blob,v(n)||r.contentType)).then(r=>t.replace(function(t){return new RegExp(`(url\\(['"]?)(${function(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}(t)})(['"]?\\))`,"g")}(n),`$1${r}$3`)).then(r=>r,()=>s)}(l,r,n,e)),Promise.resolve(o)))}function ht(t){const n=[];return t.replace(H,(e,o,i)=>(n.push(i),e)),n.filter(e=>!I(e))}var O=function(t,n,e,o){return new(e||(e=Promise))(function(s,r){function l(a){try{f(o.next(a))}catch(d){r(d)}}function u(a){try{f(o.throw(a))}catch(d){r(d)}}function f(a){a.done?s(a.value):function(s){return s instanceof e?s:new e(function(r){r(s)})}(a.value).then(l,u)}f((o=o.apply(t,n||[])).next())})};function z(t,n){return O(this,void 0,void 0,function*(){return t instanceof Element?Promise.resolve(t).then(e=>function(t,n){var e;return O(this,void 0,void 0,function*(){const o=null===(e=t.style)||void 0===e?void 0:e.getPropertyValue("background");return o?Promise.resolve(o).then(i=>j(i,null,n)).then(i=>(t.style.setProperty("background",i,t.style.getPropertyPriority("background")),t)):Promise.resolve(t)})}(e,n)).then(e=>function(t,n){if(!(t instanceof HTMLImageElement)||I(t.src))return Promise.resolve(t);const e=t.src;return Promise.resolve(e).then(o=>T(o,n)).then(o=>P(o.blob,v(e)||o.contentType)).then(o=>new Promise((i,s)=>{t.onload=i,t.onerror=s,t.srcset="",t.src=o})).then(()=>t,()=>t)}(e,n)).then(e=>function(t,n){return O(this,void 0,void 0,function*(){const o=m(t.childNodes).map(i=>z(i,n));return Promise.all(o).then(()=>t)})}(e,n)):Promise.resolve(t)})}var w=function(t,n,e,o){return new(e||(e=Promise))(function(s,r){function l(a){try{f(o.next(a))}catch(d){r(d)}}function u(a){try{f(o.throw(a))}catch(d){r(d)}}function f(a){a.done?s(a.value):function(s){return s instanceof e?s:new e(function(r){r(s)})}(a.value).then(l,u)}f((o=o.apply(t,n||[])).next())})};const L={};function Ct(t,n){return w(this,void 0,void 0,function*(){return(null!=n.fontEmbedCss?Promise.resolve(n.fontEmbedCss):function(t,n){return w(this,void 0,void 0,function*(){return function(t){return w(this,void 0,void 0,function*(){return new Promise((n,e)=>{t.ownerDocument||e(new Error("Provided element is not within a Document")),n(m(t.ownerDocument.styleSheets))}).then(n=>function(t){return w(this,void 0,void 0,function*(){const n=[],e=[];return t.forEach(o=>{if("cssRules"in o)try{m(o.cssRules).forEach((i,s)=>{if(i.type===CSSRule.IMPORT_RULE){let r=s+1;e.push(q(i.href).then(J).then(l=>{G(l).forEach(f=>{try{o.insertRule(f,f.startsWith("@import")?r+=1:o.cssRules.length)}catch(a){console.log("Error inserting rule from remote css",{rule:f,error:a})}})}).catch(l=>{console.log("Error loading remote css",l.toString())}))}})}catch(i){const s=t.find(r=>null===r.href)||document.styleSheets[0];null!=o.href&&e.push(q(o.href).then(J).then(r=>{G(r).forEach(u=>{s.insertRule(u,o.cssRules.length)})}).catch(r=>{console.log("Error loading remote stylesheet",r.toString())})),console.log("Error inlining remote css file",i.toString())}}),Promise.all(e).then(()=>(t.forEach(o=>{if("cssRules"in o)try{m(o.cssRules).forEach(i=>{n.push(i)})}catch(i){console.log(`Error while reading CSS rules from ${o.href}`,i.toString())}}),n))})}(n)).then(xt)})}(t).then(e=>Promise.all(e.map(o=>j(o.cssText,o.parentStyleSheet?o.parentStyleSheet.href:null,n)))).then(e=>e.join("\n"))})}(t,n)).then(e=>{const o=document.createElement("style"),i=document.createTextNode(e);return o.appendChild(i),t.firstChild?t.insertBefore(o,t.firstChild):t.appendChild(o),t})})}function xt(t){return t.filter(n=>n.type===CSSRule.FONT_FACE_RULE).filter(n=>W(n.style.getPropertyValue("src")))}function G(t){if(void 0===t)return[];let n=t;const e=[],r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi;n=n.replace(/(\/\*[\s\S]*?\*\/)/gi,"");const l=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");let u;for(;u=l.exec(n),null!==u;)e.push(u[0]);n=n.replace(l,"");const f=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){if(u=r.exec(n),null===u){if(u=f.exec(n),null===u)break;r.lastIndex=f.lastIndex}else f.lastIndex=r.lastIndex;e.push(u[0])}return e}function q(t,n){if(L[t])return L[t];const e=fetch(t).then(o=>({url:t,cssText:o.text()}),o=>{console.log("ERROR FETCHING CSS: ",o.toString())});return L[t]=e,e}function J(t){return w(this,void 0,void 0,function*(){return t.cssText.then(n=>{let e=n;const o=/url\(["']?([^"')]+)["']?\)/g,s=(e.match(/url\([^)]+\)/g)||[]).map(r=>{let l=r.replace(o,"$1");return l.startsWith("https://")||(l=new URL(l,t.url).href),new Promise((u,f)=>{fetch(l).then(a=>a.blob()).then(a=>{const d=new FileReader;d.addEventListener("load",Dt=>{e=e.replace(r,`url(${d.result})`),u([r,d.result])}),d.readAsDataURL(a)}).catch(f)})});return Promise.all(s).then(()=>e)})})}function Rt(t,n,e){const o="http://www.w3.org/2000/svg",i=document.createElementNS(o,"svg"),s=document.createElementNS(o,"foreignObject");return i.setAttributeNS("","width",`${n}`),i.setAttributeNS("","height",`${e}`),i.setAttributeNS("","viewBox",`0 0 ${n} ${e}`),s.setAttributeNS("","width","100%"),s.setAttributeNS("","height","100%"),s.setAttributeNS("","x","0"),s.setAttributeNS("","y","0"),s.setAttributeNS("","externalResourcesRequired","true"),i.appendChild(s),s.appendChild(t),function(t){return function(t,n,e,o){return new(e||(e=Promise))(function(s,r){function l(a){try{f(o.next(a))}catch(d){r(d)}}function u(a){try{f(o.throw(a))}catch(d){r(d)}}function f(a){a.done?s(a.value):function(s){return s instanceof e?s:new e(function(r){r(s)})}(a.value).then(l,u)}f((o=o.apply(t,n||[])).next())})}(this,void 0,void 0,function*(){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(t)).then(encodeURIComponent).then(n=>`data:image/svg+xml;charset=utf-8,${n}`)})}(i)}var p=function(t,n,e,o){return new(e||(e=Promise))(function(s,r){function l(a){try{f(o.next(a))}catch(d){r(d)}}function u(a){try{f(o.throw(a))}catch(d){r(d)}}function f(a){a.done?s(a.value):function(s){return s instanceof e?s:new e(function(r){r(s)})}(a.value).then(l,u)}f((o=o.apply(t,n||[])).next())})};function U(t,n={}){return{width:n.width||function(t){const n=y(t,"border-left-width"),e=y(t,"border-right-width");return t.clientWidth+n+e}(t),height:n.height||function(t){const n=y(t,"border-top-width"),e=y(t,"border-bottom-width");return t.clientHeight+n+e}(t)}}function Tt(t,n={}){return p(this,void 0,void 0,function*(){const{width:e,height:o}=U(t,n);return B(t,n,!0).then(i=>Ct(i,n)).then(i=>z(i,n)).then(i=>function(t,n){const{style:e}=t;n.backgroundColor&&(e.backgroundColor=n.backgroundColor),n.width&&(e.width=`${n.width}px`),n.height&&(e.height=`${n.height}px`);const o=n.style;return null!=o&&Object.keys(o).forEach(i=>{e[i]=o[i]}),t}(i,n)).then(i=>Rt(i,e,o))})}function b(t,n={}){return p(this,void 0,void 0,function*(){return Tt(t,n).then(C).then(n=>new Promise(e=>{setTimeout(()=>{e(n)},100)})).then(e=>{const o=document.createElement("canvas"),i=o.getContext("2d"),s=n.pixelRatio||function(){let t,n;try{n=process}catch(o){}const e=n&&n.env?n.env.devicePixelRatio:null;return e&&(t=parseInt(e,10),isNaN(t)&&(t=1)),t||window.devicePixelRatio||1}(),{width:r,height:l}=U(t,n),u=n.canvasWidth||r,f=n.canvasHeight||l;return o.width=u*s,o.height=f*s,o.style.width=`${u}`,o.style.height=`${f}`,n.backgroundColor&&(i.fillStyle=n.backgroundColor,i.fillRect(0,0,o.width,o.height)),i.drawImage(e,0,0,o.width,o.height),o})})}var c=g(639),Mt=g(3071),Ot=g(5970),Lt=g(5901);const Ut=["canvas"],$t=["downloadLink"],Ft=["uploader"];function kt(t,n){if(1&t&&c._UZ(0,"img",15),2&t){const e=c.oxw();c.Q6J("src",e.logo,c.LSH)}}const At=[{path:"",component:(()=>{class t{constructor(e,o,i,s,r){this.location=e,this.router=o,this.userService=i,this.alertService=s,this.tokenStorage=r,this.businessName="Company",this.contactNo=1234567890}ngOnInit(){this.getImage(),this.getUser(),this.getBusinessDetails()}getBusinessDetails(){this.userService.getBusinessDetails(this.user_id).subscribe(e=>{null!==e.businessName&&(this.businessName=e.businessName),null!==!e.contactNo&&(this.contactNo=e.contactNo)})}popFileChooser(){this.uploader.nativeElement.click()}onSelectFile(e){if(e.target.files&&e.target.files[0]){let o=new FileReader;o.readAsDataURL(e.target.files[0]),o.onload=i=>{this.logo=i.target.result}}}getImage(){this.image_url=this.userService.getImageFromStorage()}getUser(){let e=this.tokenStorage.DecodeToken();this.user_id=e.user_id,this.business_id=e.business_id}downloadImage(){b(document.getElementById("image")).then(o=>{this.canvas.nativeElement.src=o.toDataURL(),this.downloadLink.nativeElement.href=o.toDataURL("image/png"),this.downloadLink.nativeElement.download="image.png",this.downloadLink.nativeElement.click(),this.userService.saveEditedImage(o.toDataURL(),this.user_id).subscribe(i=>{this.alertService.presentToast(i.msg,"success"),this.router.navigate(["/home"])})})}ngOnDestroy(){this.userService.remove("image")}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(S.Ye),c.Y36(x.F0),c.Y36(Mt.K),c.Y36(Ot.c),c.Y36(Lt.i))},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-editimage"]],viewQuery:function(e,o){if(1&e&&(c.Gf(Ut,5),c.Gf($t,5),c.Gf(Ft,7)),2&e){let i;c.iGM(i=c.CRH())&&(o.canvas=i.first),c.iGM(i=c.CRH())&&(o.downloadLink=i.first),c.iGM(i=c.CRH())&&(o.uploader=i.first)}},decls:27,vars:4,consts:[["slot","start"],["slot","end","id","choose-file",3,"click"],["type","file","accept","image/png, image/gif, image/jpeg","hidden","",3,"change"],["uploader",""],[1,"content"],["id","image"],["id","logo",3,"src",4,"ngIf"],["id","background-img",3,"src"],["id","businessName"],["contenteditable","true"],[3,"click"],["name","cloud-download-outline"],["id","download"],["canvas",""],["downloadLink",""],["id","logo",3,"src"]],template:function(e,o){1&e&&(c.TgZ(0,"ion-header"),c.TgZ(1,"ion-toolbar"),c.TgZ(2,"ion-buttons",0),c._UZ(3,"ion-back-button"),c.qZA(),c.TgZ(4,"ion-button",1),c.NdJ("click",function(){return o.popFileChooser()}),c._uU(5," Upload Logo "),c.TgZ(6,"input",2,3),c.NdJ("change",function(s){return o.onSelectFile(s)}),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(8,"ion-content"),c.TgZ(9,"div",4),c.TgZ(10,"ion-card"),c.TgZ(11,"ion-card-content",5),c.YNc(12,kt,1,1,"img",6),c._UZ(13,"ion-img",7),c.TgZ(14,"div",8),c.TgZ(15,"h1",9),c._uU(16),c.qZA(),c.qZA(),c.TgZ(17,"h4",9),c._uU(18),c.qZA(),c.qZA(),c.qZA(),c.TgZ(19,"ion-button",10),c.NdJ("click",function(){return o.downloadImage()}),c._UZ(20,"ion-icon",11),c._uU(21," Download Image "),c.qZA(),c.qZA(),c.TgZ(22,"div",12),c._UZ(23,"img",null,13),c._UZ(25,"a",null,14),c.qZA(),c.qZA()),2&e&&(c.xp6(12),c.Q6J("ngIf",o.logo),c.xp6(1),c.Q6J("src","data:image/png;base64, "+o.image_url),c.xp6(3),c.Oqu(o.businessName),c.xp6(2),c.hij("+91",o.contactNo,""))},directives:[h.Gu,h.sr,h.Sm,h.oU,h.cs,h.YG,h.W2,h.PM,h.FN,S.O5,h.Xz,h.gu],styles:["ion-back-button[_ngcontent-%COMP%]{display:block}#choose-file[_ngcontent-%COMP%]{width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}.content[_ngcontent-%COMP%]{position:relative;display:grid;align-items:center;justify-content:center}.content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{z-index:1;display:grid;grid-template-columns:repeat(1,1fr)}.content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{position:relative;display:grid;align-items:center;justify-items:center}.content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   #logo[_ngcontent-%COMP%]{position:absolute;top:4%;left:7%;border-radius:50%;width:55px;height:60px}.content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   #background-img[_ngcontent-%COMP%]{background-size:cover;background-attachment:fixed}.content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   #businessName[_ngcontent-%COMP%]{position:absolute;top:3.5%;left:24%;display:flex;align-items:center;text-align:center;justify-content:center;word-break:break-all;z-index:5;height:65px;width:210px}.content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   #businessName[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#1d1c1c;text-overflow:ellipsis;font-size:1.6rem;font-weight:700}.content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{position:absolute;z-index:5;color:#1d1c1c;top:13.8%;left:48%;font-weight:700;font-size:.9rem}.content[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin:0 1rem;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;justify-self:center}.content[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:1rem}"]}),t})()}];let It=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.oAB({type:t}),t.\u0275inj=c.cJS({imports:[[x.Bz.forChild(At)],x.Bz]}),t})(),Zt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.oAB({type:t}),t.\u0275inj=c.cJS({imports:[[S.ez,V.u5,h.Pc,It]]}),t})()}}]);